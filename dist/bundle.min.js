(()=>{"use strict";const t=1e3,i={debug:!1,APP_ELEMENT:"#app",CANVAS_WIDTH:t,CANVAS_HEIGHT:600,GROUND_HEIGHT:60,GROUND_START_Y:540,GRAVITY:.4,STAGE_MAX_X:11e3};class e{constructor(t){this.options=t}update(t){}draw(t){}}const s=new class{constructor(){this.drawItems={},this.player=void 0,this.timer=0,this.keyboard=[],this.setKeyEvent();const t=document.querySelector(i.APP_ELEMENT),e=document.createElement("canvas"),[s,h]=[i.CANVAS_WIDTH,i.CANVAS_HEIGHT];[t.style.width,t.style.height]=[`${s}px`,`${h}px`],[e.width,e.height]=[s,h],this.ctx=e.getContext("2d"),t.appendChild(e)}setPlayer(t){this.player=t}addDrawItems(t,i){this.drawItems[t]=i}setKeyEvent(){document.addEventListener("keydown",(t=>{this.keyboard=[...new Set([...this.keyboard,t.code])]})),document.addEventListener("keyup",(t=>{this.keyboard=this.keyboard.filter((i=>i!==t.code))}))}_draw(){this.ctx.fillStyle="skyblue",this.ctx.fillRect(0,0,i.CANVAS_WIDTH,i.CANVAS_HEIGHT),this.ctx.fillStyle="green",this.ctx.fillRect(0,i.GROUND_START_Y,i.CANVAS_WIDTH,i.GROUND_HEIGHT),Object.values(this.drawItems).forEach((t=>{t.update(this),t.draw(this)})),this.player.update(this),this.player.draw(this),this.timer=requestAnimationFrame(this._draw.bind(this))}run(){this._draw()}},h=new class extends e{constructor(t){super(t),this.height=32,this.yv=10,this.realY=0,this.realX=0,this.viewY=0,this.viewX=0,this.jumping=!1,this.moving=!1,this.standingPos=0,this.jumpTop=void 0,this.jumpingTimer=0,this.currentStage=void 0,this.downing=!1,this.downingTimer=0}draw(t){const e=this.height/2;t.ctx.beginPath(),t.ctx.arc(e+this.viewX,i.GROUND_START_Y+this.viewY-e-.5,e,0*Math.PI/180,360*Math.PI/180,!1),t.ctx.fillStyle="red",t.ctx.fill(),t.ctx.strokeStyle="crimson",t.ctx.lineWidth=1,t.ctx.stroke()}update(t){if(t.keyboard.find((t=>"ArrowRight"===t))){this.moving=!0,this.realX+=2;const t=i.CANVAS_WIDTH/2;this.realX>=t&&this.realX<=i.STAGE_MAX_X-t?this.viewX=i.CANVAS_WIDTH/2:this.realX>=i.STAGE_MAX_X?(this.realX=i.STAGE_MAX_X,this.viewX=i.CANVAS_WIDTH):this.viewX+=2}else if(t.keyboard.find((t=>"ArrowLeft"===t))){this.moving=!0,this.realX-=2;const t=i.CANVAS_WIDTH/2;this.realX>=t&&this.realX<=i.STAGE_MAX_X-t?this.viewX=i.CANVAS_WIDTH/2:this.realX<=0?this.realX=this.viewX=0:this.viewX-=2}else this.moving=!1;!t.keyboard.find((t=>"ArrowUp"===t))||this.jumping||this.downing||(this.jumping=!0,this.standingPos=this.realY,this.jumpTop=void 0,this.jumpingTimer=0);const e=t.drawItems.stage.getStandPlace(t),s=this.realX+this.height/2;this.currentStage&&(this.currentStage.x>s||this.currentStage.x+this.currentStage.width<s)&&!this.downing&&!this.jumping&&(this.downing=!0,this.standingPos=this.realY,this.downingTimer=0),this.jumping&&this._jump(e),this.downing&&this._down(e)}_jump(t){const e=this.realY;this.realY=this.standingPos+.5*i.GRAVITY*this.jumpingTimer*this.jumpingTimer-this.yv*this.jumpingTimer,this.jumpingTimer++,this.realY>1&&this._reset();const s=e<this.realY;s&&!this.jumpTop&&(this.jumpTop=e);const h=t.find((t=>this.jumpTop<=t.y-i.GROUND_START_Y&&e<=t.y-i.GROUND_START_Y&&this.realY>=t.y-i.GROUND_START_Y));s&&h&&this._reset(h),this.viewY=this.realY}_down(t){const e=this.realY;this.realY=.5*i.GRAVITY*this.downingTimer*this.downingTimer+this.standingPos,this.downingTimer++,this.realY>1&&this._reset();const s=t.find((t=>e<=t.y-i.GROUND_START_Y&&this.realY>=t.y-i.GROUND_START_Y));s&&this._reset(s),this.viewY=this.realY}_reset(t){t?(this.realY=t.y-t.height+this.height/2-i.GROUND_START_Y+5,this.jumping=!1,this.downing=!1,this.jumpTop=void 0,this.currentStage=t):(this.realY=0,this.downing=!1,this.currentStage=void 0,this.jumping=!1,this.jumpTop=void 0)}},r=new class extends e{constructor(t){super(t),this.stageHeight=10;let e=0;this.stages=[];let s=0;[...Array(10)].forEach((()=>{this.stages=[...[...Array(10)].map((()=>{const t=i.CANVAS_WIDTH+e*i.CANVAS_WIDTH,h=e*i.CANVAS_WIDTH,r=Math.floor(Math.random()*t)+h;s=r;const a=i.GROUND_START_Y-50;return{x:r,y:Math.floor(Math.random()*a)+1,height:20,width:100}})),...this.stages],s=e*i.CANVAS_WIDTH,e++})),this.stages.sort(((t,i)=>t[1]<i[1]?-1:1))}draw(t){const e=t.player.realX;let s=0,h=i.CANVAS_WIDTH;e>=i.CANVAS_WIDTH/2&&(s=e-i.CANVAS_WIDTH/2,h=e+i.CANVAS_WIDTH/2),this.stages.filter((t=>t.x+t.width>=s&&t.x<=h)).forEach((e=>{t.ctx.strokeStyle="gray",t.ctx.fillStyle="#505050";let s=0;const h=i.CANVAS_WIDTH/2;t.player.realX<=h?s=0:t.player.realX>=h&&t.player.realX<=i.STAGE_MAX_X-h?s=t.player.realX-h:t.player.realX>=i.STAGE_MAX_X-h&&(s=i.STAGE_MAX_X-i.CANVAS_WIDTH),t.ctx.strokeRect(e.x-s,e.y,e.width,e.height),t.ctx.fillRect(e.x-s,e.y,e.width,e.height)}))}getStandPlace(t){const i=t.player.realX+t.player.height/2;return this.stages.filter((t=>t.x<=i&&t.x+t.width>=i)).sort(((t,i)=>t.y<i.y?-1:1))}};s.setPlayer(h),s.addDrawItems("stage",r),s.run()})();